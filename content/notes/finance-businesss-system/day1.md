---
title: "业务初探:扫了二维码之后发生了什么?"
date: 2023-04-06
tags:
  - 金融业务与系统
categories:
  - 读书笔记
type: posts
lightgallery: true
description: "金融业务与系统，扫描二维码"
keywords: 
  - 金融系统
---

金融业务，按业务划分为两种：交易类业务和信贷类业务。

扫码业务：
- 业务具有代表性，最常见；
- 传统银行业务的标志性机构大都参与到扫码支付的过程中；
- 具有互联网应用和金融运用双重属性

## 情景假设

**跨境电商相关的扫码跨境支付场景**

1. 付款方用户支付的是**人民币**。
2. 付款方的借记卡是国内银行 A 发行的，简称买家开户行。
3. 第三方支付公司的备付金账户在国内银行 B，简称第三方开户行。 
4. 收款方接受的是美元。
5. 收款方的借记卡是国外银行 C 发行的，简称卖家开户行。
6. 第三方公司是通过银行 D 进行外币兑换业务，简称汇兑提供行。

## 用户扫码

### 鉴权

查看用户状态，查看扫码人是否有银行卡的使用权。
主要看四要素：
1. 用户姓名
2. 用户身份证号码 
3. 银行卡号码
4. 银行注册的手机号
5. 短信验证是否拥有该手机号

步骤：
1. 用户填写前 3 个要素和手机 号码;
2. 银行发短信验证码给用户手机号;
3. 用户将前 3 个要素和短信验证码发给第三方支付公司;
4. 第三方支付公司再将所有信息发送给银行进行确认

{{<figure src="authentication.png" width="800" >}}

### 支付

### 拉取状态

1. 需要轮询拉取支付状态。
2. 通过异步消息处理的过程中，削峰填谷
3. 银行处理完成，**推送消息至用户和第三方支付公司**

## 本币代收 (第三方支付公司)

央行和清算中心：
- 怎么将钱在两家银行之间转来转去
  - 第三方机构，央行：存款准备金
  - 每日记录，不进行跨行转账；每日只进行一次最终计算，提交给央行（轧差）；
    - 实时消息批量处理
  - 记录跨行转账细节和晚上进行轧差的第三方机构
    - 银联、网联、国外的万事达

跨行转账流程：

1. 第三方支付公司发送指令给第三方开户行，要求将钱从用户的买家开户行转到第三方开户行
2. 第三方支付公司拥有用户在买家开户行的 Token，所以可以合法发起这笔转账
3. 第三方开户行将所有信息交给清算机构
4. 买家开户行记录的结果是对用户的账号进行扣款
5. 第三方开户行记录的结果是对第三方支付公司的账号进行打款
6. 清算机构对白天发生的交易进行盘存，发现有一笔从买家开户行到第三方开户行的跨行转账还没有真正完成。
7. 央行收到信息之后，将买家开户行在央行的存款准备金调低，并将第三方开户行在央行的存款准备金调高

{{<figure src="transfer-account.png" width="800" >}}

## 外汇交易 (第三方支付公司)

### C 端外汇零售业务

一个账号只处理同一个币种的交易。外汇交易涉及到两个币种的货币,需要两个不同的账号。

{{<figure src="transfer-account2.png" width="800" >}}

四个账号的两笔交易。
交易成本：1 时间成本，外汇可能隔天才能到账；2 交易成本，按照次数收费；因此 ，为了节约成本，会一次行买入大量外汇，对应日间业务，当外汇储备下降到警戒线之后，再做下一笔大额外汇的购买。

{{<figure src="transfer-account3.png" width="800" >}}

从买家到外汇结账的流通图。
单存在的问题是，汇兑提供行帮助第三方支付公司购买外汇，但汇兑提供行的美元账户一直在出钱，需要B端外汇批发提供帮助。

### B 端外汇批发业务

一个处理外汇批发的巨头银行。

{{<figure src="transfer-account4.png" width="800" >}}

## 外币代付 (第三方支付公司)

外币代付不同点在于，外币代付的金额是美金。走的是国际清结算过程。